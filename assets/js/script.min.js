function initPlaylistCheckbox(a){El(a).on("change",function(a){return function(){a.checked?addVideoToPlaylist(a.getAttribute("data-playlist-id"),_VIDEO_ID_):removeVideoFromPlaylist(a.getAttribute("data-playlist-id"),_VIDEO_ID_)}}(a))}function ChatMessage(){var a=this;this.data="",this.sender="",this.content="",this.messageType="text",this.channel=Chat.channel,this.timestamp=Math.round(+new Date/1e3),this.construct=function(b,c,d){a.sender=b,a.content=c,0==c.lastIndexOf("/",0)&&(a.messageType="command");var e={sender_name:a.sender,content:a.content,messageType:a.messageType,channel:a.channel,timestamp:a.timestamp};d.length>0&&(e.sessionId=d),a.data=JSON.stringify(e)},this.parse=function(b){try{var c=JSON.parse(b);a.sender=c.sender_name,a.content=c.content,a.messageType=c.messageType,a.timestamp=c.timestamp}catch(d){alert(d)}}}function initChat(a){Chat.address=a.address,Chat.port=a.port,Chat.channel=a.channel,Chat.username=a.username?a.username:"Dreamer",Chat.sessionId=a.sessionId,Chat.start()}function sendChatMessage(){if(Chat.connected){var a=document.getElementById("message-box"),b=new ChatMessage;b.construct(Chat.username,a.value,Chat.sessionId),Chat.socket.send(b.data),Screen.pushMessage(b),a.value=""}}function keyPress(a){"undefined"==typeof a&&window.event&&(a=window.event);var b=document.getElementById("message-box");document.activeElement==b&&13==a.keyCode&&document.getElementById("message-send").click()}function postComment(a,b,c,d){marmottajax.post({url:"../comments/",options:{commentSubmit:"lol","comment-content":b,"from-channel":c,"video-id":a,parent:d}}).then(function(a){return function(b){var c=JSON.parse(b);c.channelUrl=a,c.avatar=_my_avatar_,c.plusNumber=0,c.moinsNumber=0,c.date="À l'instant",El("#comments-best").addFirst(Co('<comment data="${data}"/>',{data:c}))}}(c)),El("#textarea-comment").value=""}function playListScroll(a){El("#playlist-videos").scrollLeft+=a}function redirectOverlayUpdate(){var a=document.getElementById("redirect-at-end");a.innerHTML=a.getAttribute("data-message").replace("{time}",Application.redirectOverlayTime)+"<br>";var b=document.createElement("div");b.className="video__redirect-at-end__cancel",b.innerHTML=a.getAttribute("data-cancel-message"),b.onclick=cancelRedirectOverlay,a.appendChild(b)}function cancelRedirectOverlay(){var a=document.getElementById("redirect-at-end");clearInterval(Application.redirectOverlayInterval),Application.redirectOverlayTime=5,Application.redirectOverlay=!1,a.className=a.className.replace("video__redirect-at-end--show","")}function $(a){"function"==typeof a&&Application.dom_load_event_listeners.push(a)}function isset(a){return"undefined"!=typeof a}function backgroundLoader(a){this.element=El(a),this.src=this.element.getAttribute("data-background"),this.element.style.backgroundImage="url("+this.src+")",this.imgLoader=new Image,this.imgLoader.src=this.src,El(this.imgLoader).on("load",function(a,b){b.removeClass("bg-loader"),b.addClass("bg-loader-transition"),b.addClass("bg-loaded"),setTimeout(function(a){return function(){a.removeClass("bg-loader-transition")}}(b),300)},this.element)}function postMessage(){marmottajax.post({url:"../../../posts",json:!0,options:{"post-message-submit":"lol",channel:El("#channel-social-message-submit").getAttribute("data-channel-id"),"post-content":El("#post-content").value}}).then(function(){return function(a){El("#channel-posts").addFirst(Co('<channel-post avatar="${avatar}" channel="${channel}" message="${message}"/>',{avatar:_my_avatar_,channel:_my_pseudo_,message:a.content}))}}(El("#channel-social-message-submit").getAttribute("data-channel-id"))),El("#post-content").value=""}function setExporterInputValue(){if(!document.getElementById("exporter-input"))return!1;var a=El("#exporter-input"),b=El("#exporter-quality"),c=El("#exporter-autoplay"),d=El("#exporter-time-checkbox"),e=El("#exporter-time-input"),f="//dreamvids.fr/embed/"+_VIDEO_ID_,g=b.options[b.value].innerHTML||"640x360",h=g.split("x");width=h[0],height=h[1];var i=c.checked||!1;i&&(f+="/autoplay");var j=d.checked||!1;if(j)for(var k=e.value,l=k.split(":").reverse(),m=0;m<l.length;m++)f+=l[m]+"/";a.value='<iframe width="'+width+'" height="'+height+'" src="'+f+'" allowfullscreen frameborder="0"></iframe>'}var Application={name:"DreamVids"};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),new Component({name:"btn",render:function(a){var b="raised"===a.type?"raised":"flat",c=a.color?".btn--"+a.color:"",d=a.outline?".btn--outline-"+a.outline:"",e=a.ripple?".btn--ripple-"+a.ripple:"",f=isset(a.disable)?".disabled":"",g=new Element("div.btn.btn--"+b+c+d+e+f);return f||(g.tabIndex=0),"function"==typeof a.click&&El(g).on("CLICK",a.click,g),a["no-ripple"]||El(g).add(Co('<ripple parent="${parent}"/>',{parent:g})),g}}),new Co({name:"card",render:function(a){var b=isset(a.type)?a.type:"video";if("video"===b){var c=new El("div.card.video"),d=c.add(new El("div.thumbnail"));d.style.backgroundImage="url("+a.thumbnail+")";var e=d.add(new El("div.time"));e.innerHTML=a.duration;var f=d.add(new El("a.overlay"));f.href="watch/"+a["vid-id"];var g=c.add(new El("div.description")),h=g.add(new El("a"));h.href="watch/"+a["vid-id"];var i=h.add(new El("h4"));i.innerHTML=a.title;var j=g.add(new El("div")),k=j.add(new El("div.view"));k.innerHTML=a.views;var l=j.add(new El("a.channel"));l.href="channel/"+a.channel,l.innerHTML=a["channel-name"]}else if("plus"==b){var c=new El("div.card.plus"),m=c.add(new El("a"));m.href="watch/"+a["vid-id"];var d=m.add(new El("div.thumbnail"));d.style.backgroundImage="url("+a.thumbnail+")";var n=m.add(new El("p")),o=n.add(new El("b"));o.innerHTML=a["channel-name"],n.innerHTML+=' a aimé votre vidéo "<b>'+a["vid-name"]+'</b>"';var p=c.add(new El("i"));p.innerHTML=a["relative-time"]}else if("comment"==b){var c=new El("div.card.comment"),m=c.add(new El("a"));m.href="watch/"+a["vid-id"];var n=m.add(new El("p")),o=n.add(new El("b"));o.innerHTML=a["channel-name"],n.innerHTML+=' a commenté votre vidéo "<b>'+a["vid-name"]+'</b>"';var q=m.add(new El("blockquote"));q.innerHTML=a.comment;var p=c.add(new El("i"));p.innerHTML=a["relative-time"]}else if("channel"==b){var c=new El("div.card.channel"),m=c.add(new El("a"));m.href="watch/"+a.channel;var r=m.add(new El("div.avatar"));r.style.backgroundImage="url("+a.avatar+")";var n=m.add(new El("p")),o=n.add(new El("b"));o.innerHTML=a["channel-name"],n.innerHTML+=" s'est abonné à votre chaîne \"<b>"+a["my-channel-name"]+'</b>"';var s=c.add(new El("span.subscribers"));s.innerHTML="<b>"+a.subscribers+"</b> Abonnés";var p=c.add(new El("i"));p.innerHTML=a["relative-time"]}return c.on("CLICK",a.click,c),c}}),new Co({name:"channel-post",render:function(a){var b=new Element("div.channel-post"),c=b.add(new Element("img"));c.src=a.avatar;var d=b.add(new Element("p")),e=d.add(new Element("span.channel-name"));e.innerHTML=a.channel,d.innerHTML+=" a posté un message :";var f=b.add(new Element("div.social-message"));return f.innerHTML=a.message,b}}),new Co({name:"comment",render:function(a){if(a.data){var b=a.data,c=new El("div.comment"),d=c.add(new El("div.comment-head")),e=d.add(new El("div.user")),f=e.add(new El("img"));f.src=_my_avatar_;var g=e.add(new El("a"));g.href="../channel/"+b.channelUrl,g.innerHTML=b.author;var h=d.add(new El("div.date")),i=h.add(new El("p"));i.innerHTML=b.date;var j=c.add(new El("div.comment-text")),k=j.add(new El("p"));k.innerHTML=b.comment;var l=c.add(new El("div.comment-notation")),m=l.add(new El("ul")),n=m.add(new El("li.plus")),o=m.add(new El("li.moins"));return n.id="plus-"+b.id,o.id="moins-"+b.id,n.onclick=function(a){return function(){likeComment(a)}}(b.id),o.onclick=function(a){return function(){dislikeComment(a)}}(b.id),n.innerHTML="+"+b.plusNumber,o.innerHTML="-"+b.moinsNumber,c}}}),new Component({name:"ripple",render:function(a){var b=new Element("div.ripple");if(a.parent){var c="ontouchstart"in window?"touchstart":"mousedown";El(a.parent).on(c,function(a,b){var c=b.ripple,d=b.parent;if(!El(d).hasClass("disabled")){var e=c.add(new El("div.ripple__circle.ripple__circle--animate")),f=El(d).offset(),g=a.changedTouches?a.changedTouches[0].pageX:a.pageX,h=a.changedTouches?a.changedTouches[0].pageY:a.pageY;e.style.left=g-f.x+"px",e.style.top=h-f.y+"px"}},{ripple:b,parent:a.parent})}return b}}),new Script({pages:["watch"],call:function(){if(!El("#add-playlist-icon"))return!1;El("#add-playlist-icon").onclick=function(){var a=El("#video-info-description");a.hasClass("playlist")?(a.removeClass("export"),a.removeClass("playlist")):(a.removeClass("export"),a.addClass("playlist"))};var a=El("#playlist-add-form-list").childNodes;for(child in a)a.hasOwnProperty(child)&&"INPUT"===a[child].nodeName&&initPlaylistCheckbox(a[child])}}),new Script({call:function(){}});var Screen={pushInfo:function(a){var b=document.getElementById("messages-panel"),c=document.createElement("div");c.className="info";var d=document.createElement("span");d.className="info";var e=document.createTextNode("Info: "+a);d.appendChild(e),c.appendChild(d),b.appendChild(c),c.scrollTop=c.scrollHeight},pushError:function(a){var b=document.getElementById("messages-panel"),c=document.createElement("div");c.className="error";var d=document.createElement("span");d.className="content";var e=document.createTextNode("Error: "+a);d.appendChild(e),c.appendChild(d),b.appendChild(c),c.scrollTop=c.scrollHeight},pushMessage:function(a){var b=document.getElementById("messages-panel"),c=document.createElement("div");c.className="message";var d=document.createElement("span"),e=document.createElement("span");d.className="sender",e.className="content";var f=document.createTextNode(a.sender),g=document.createTextNode(a.content);d.appendChild(f),e.appendChild(g);var h=document.createTextNode(": ");c.appendChild(d),c.appendChild(h),c.appendChild(e),b.appendChild(c),c.scrollIntoView()},clearFirst:function(){var a=document.getElementById("messages-panel");a.removeChild(a.firstChild)}},Chat={connected:!1,socket:null,address:"127.0.0.1",port:8080,channel:"",username:"Dreamer",sessionId:"",start:function(){this.socket=new WebSocket("ws://"+this.address+":"+this.port+"/"+this.channel),this.socket.onopen=this.onConnect,this.socket.onclose=this.onDisconnect,this.socket.onmessage=this.onMessage,this.socket.onerror=this.onError},onConnect:function(){var a=new ChatMessage;a.construct(Chat.username,""),Chat.socket.send(a.data),Chat.connected=!0,Screen.pushInfo("Connected maggle ! Welcome !")},onMessage:function(a){try{var b=new ChatMessage;b.parse(a.data),Screen.pushMessage(b)}catch(c){Screen.pushError(c.message)}},onDisconnect:function(){Chat.connected=!1,Screen.pushInfo("Disconnected")},onError:function(){Screen.pushError("WebSocket error")}};new Script({pages:["live"],call:function(){console.log("blaaaa"),console.log(liveChatOptions),console.log(initChat),initChat(liveChatOptions)}}),new Script({pages:["watch"],call:function(){return El("#post-comment-button")?void(El("#post-comment-button").onclick=function(){postComment(El("#post-comment-button").getAttribute("data-vid-id"),El("#textarea-comment").value,El("#channel-selector").value,El("#parent-comment").value)}):!1}}),new Script({pages:["watch"],call:function(){if(!document.getElementById("playlist-button-scroll-left"))return!1;var a=El("#playlist-button-scroll-left"),b=El("#playlist-button-scroll-right");a.onclick=function(){playListScroll(-300)},b.onclick=function(){playListScroll(200)}}}),new Script({pages:["watch"],call:function(){var a=document.getElementById("video-tag");return a?(Application.redirectOverlay=!1,void a.addEventListener("ended",function(){if(!Application.redirectOverlay&&(Application.redirectOverlay=!0,"undefined"!=typeof _redirectAtEnd&&""!==_redirectAtEnd)){var a=document.getElementById("redirect-at-end");Application.redirectOverlayTime=5,redirectOverlayUpdate(),a.className.indexOf("video__redirect-at-end--show")<0&&(a.className+=" video__redirect-at-end--show"),Application.redirectOverlayInterval&&(clearInterval(Application.redirectOverlayInterval),Application.redirectOverlayInterval=null),Application.redirectOverlayInterval=setInterval(function(){Application.redirectOverlayTime--,redirectOverlayUpdate(),0===Application.redirectOverlayTime&&(document.location=_redirectAtEnd)},1e3)}},!1)):!1}}),Application.dom_load_event_listeners=[],Application.dom_content_loaded=!1,Application.on_dom_content_loaded=function(){if(!Application.dom_content_loaded){Application.dom_content_loaded=!0;for(var a=0;a<Application.dom_load_event_listeners.length;a++){var b=Application.dom_load_event_listeners[a];"function"==typeof b&&b()}}},El(document).on("DOMContentLoaded",Application.on_dom_content_loaded),El(window).on("load",Application.on_dom_content_loaded),window.onload=function(){Application.on_dom_content_loaded()},$(function(){for(var a=0;a<Application.scripts.length;a++){var b=!1,c=Application.scripts[a];if("*"!==c.pages&&"all"!==c.pages&&c.pages)for(var d=0;d<c.pages.length;d++)c.pages[d]===_currentpage_&&(b=!0);else b=!0;b&&c.call()}}),Application.scripts=[];var Script=function(a){this.pages=a.pages,this.to_call=a.call,Application.scripts.push(this)};Script.prototype.call=function(){this.to_call()},new Script({call:function(){var a=document.getElementsByClassName("bg-loader");if(a&&a.length)for(var b=0,c=a.length;c>b;b++)new backgroundLoader(a[b])}}),new Script({pages:["channel"],call:function(){var a=El("#channel-social-message-submit");a&&(a.onclick=postMessage,El("#post-content").on("keydown",function(a){13===a.keyCode&&a.ctrlKey&&postMessage()}))}}),new Script({pages:["watch"],call:function(){return El("#embed-video-icon")?(El("#embed-video-icon").onclick=function(){var a=El("#video-info-description");a.hasClass("export")?(a.removeClass("playlist"),a.removeClass("export")):(a.removeClass("playlist"),a.addClass("export"),El("#exporter-input").select())},El("#exporter-quality").on("change",setExporterInputValue),El("#exporter-autoplay").on("change",setExporterInputValue),El("#exporter-time-checkbox").on("change",setExporterInputValue),El("#exporter-time-input").on("change",setExporterInputValue),void setExporterInputValue()):!1}}),new Script({pages:["default","watch"],call:function(){}}),new Script({pages:["watch"],call:function(){return El("#share-video-icon")?void(El("#share-video-icon").onclick=function(){var a=El("#share-video-block"),b=El("#video-info-description");a.toggleClass("show"),b.toggleClass("little")}):!1}});