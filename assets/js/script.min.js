function background_loader(a){this.element=a,this.src=this.element.getAttribute("data-background"),this.element.style.backgroundImage="url("+this.src+")",this.imgLoader=new Image,this.imgLoader.src=this.src,this.imgLoader.addEventListener("load",function(){a.className=a.className.replace("bgLoader",""),a.className=a.className.replace("bg-loader",""),a.className+=" bgLoaderTransition bgLoaded",a.className+=" bg-loader-transition bg-loaded",setTimeout(function(a){return function(){a.className=a.className.replace("bg-loader-transition","")}}(a),300)},!1)}function postComment(a,b,c){marmottajax.post({url:"../comments/",options:{commentSubmit:"lol","comment-content":b,"from-channel":c,"video-id":a}}).then(function(a){var b=JSON.parse(a),c=document.createElement("div");c.className="comment";var d=document.createElement("div");d.className="comment-head";var e=document.createElement("div");e.className="user";var f=document.createElement("img");f.setAttribute("src","../assets/img/avatar_user.png");var g=document.createElement("a");g.setAttribute("href","#");var h=document.createTextNode(b.author);g.appendChild(h),e.appendChild(f),e.appendChild(g),d.appendChild(e);var i=document.createElement("div");i.className="date";var j=document.createElement("p"),k=document.createTextNode(b.relativeTime);j.appendChild(k),i.appendChild(j),d.appendChild(i),c.appendChild(d);var l=document.createElement("div");l.className="comment-text";var m=document.createElement("p"),n=document.createTextNode(b.comment);m.appendChild(n),l.appendChild(m),c.appendChild(l);var o=document.createElement("div");o.className="comment-notation";var p=document.createElement("ul"),q=document.createElement("li"),r=document.createElement("li");q.className="plus",r.className="moins";var s=document.createElement("a");s.setAttribute("href","#");var t=document.createTextNode("+");s.appendChild(t),q.appendChild(s);var u=document.createElement("a");u.setAttribute("href","#");var v=document.createTextNode("-");u.appendChild(v),r.appendChild(u);var w=document.createTextNode("0");q.appendChild(w);var x=document.createTextNode("0");r.appendChild(x),p.appendChild(q),p.appendChild(r),o.appendChild(p),c.appendChild(o),document.getElementById("comments-best").appendChild(c)})}function resized(){document.body.clientWidth<640?(player.style.width=document.body.clientWidth+"px",player.style.height="undefined"!=typeof embeded?document.documentElement.clientHeight+"px":player.offsetWidth/(16/9)+"px",videoInfos&&(videoInfos.style.height=player.offsetWidth/(16/9)+"px")):(player.style.width="",player.style.height="",videoInfos&&(player.className.search("wide")>0?(player.style.height="undefined"!=typeof embeded?document.documentElement.clientHeight+"px":player.offsetWidth/(16/9)+"px",videoInfos.style.height=player.offsetWidth/(16/9)+"px"):videoInfos.style.height="")),player.style.height="undefined"!=typeof embeded?document.documentElement.clientHeight+"px":player.offsetWidth/(16/9)+"px"}function playPause(){playPauseElement.className=video.paused?"play":"pause",video.paused?video.play():video.pause()}function time2str(a){var b=(new Date(a),Math.floor(a/3600)),c=Math.floor(a/60),d=Math.floor(a-60*c);return c-=60*b,b=10>b?"0"+b:b,c=10>c?"0"+c:c,d=10>d?"0"+d:d,(b>0?b+":":"")+c+":"+d}function bufferUpdate(){video.buffered&&video.duration&&video.buffered.length&&(percent=video.buffered.end(video.buffered.length-1)/video.duration*100,progress.buffered.style.width=percent>=0&&100>=percent?percent+"%":"0%")}function getOffset(a){if(document.webkitFullscreenElement||document.mozFullscreenElement||document.fullscreenElement)return a.offsetLeft;var b=0;for(element=a;element;)b+=element.offsetLeft-(element==document.body?0:element.scrollLeft)+element.clientLeft,element=element.offsetParent;return b}function downPlayer(){video.paused||(lastTime=(new Date).getTime(),annotationsElement.style.cursor="none",controls.className="down",player.className="down")}function upPlayer(){(new Date).getTime()-300<lastTime||(annotationsElement.style.cursor="default",controls.className="",player.className=player.className.replace("down",""),clearTimeout(timeout),timeout=setTimeout(downPlayer,time2down/2))}function toogleFullScreen(){"undefined"==typeof annoTimeLine&&(player.className=player.className.search("wide")>0?"wide":"",document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():player.requestFullscreen?player.requestFullscreen():player.msRequestFullscreen?player.msRequestFullscreen():player.mozRequestFullScreen?player.mozRequestFullScreen():player.webkitRequestFullscreen&&player.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT))}function setImageFullscreen(a){fullscreen.className=a}function volumeChange(){ajax.post({action:"volume",vol:video.volume})}function setVolume(a){video.volume=a}function mouseWheelVolume(a){(document.webkitFullscreenElement||document.mozFullscreenElement||document.fullscreenElement)&&(upPlayer(),lastVolume=video.volume,video.volume=a.wheelDelta>0||a.detail<0?Math.min(video.volume+.1,1):Math.max(video.volume-.1,0),lastVolume!=video.volume&&volumeChange())}function setQuality(a){if(player.style.height="undefined"!=typeof embeded?document.documentElement.clientHeight+"px":player.offsetWidth/(16/9)+"px",videoInfos&&(videoInfos.style.height=player.offsetWidth/(16/9)+"px"),qualitySelection.className="",length=qualitys.length,currentQuality!=a)for(var b=0;length>b;b++)quality=qualitys[b],quality.format==a&&(qualityButton.className=720>a?"":"bold",qualityButton.innerHTML=720>a?"SD":1080>a?"HD":"Full HD",lastTime=video.currentTime||lastTime,srcMp4.src=quality.mp4,srcWebm.src=quality.webm,currentQuality=a,video.load(),video.addEventListener("loadeddata",function(){("undefined"==typeof embeded||0!=video.currentTime)&&(video.currentTime=lastTime,video.play())}))}function setVideo(a){qualityButton.style.cursor=a.length<=1?"default":"pointer",qualitys=a;for(var b=0,c=qualitys.length;c>b;b++)element=document.createElement("span"),element.id="q"+(b+1),element.innerHTML=qualitys[b].format+"p",element.dataset.format=qualitys[b].format,element.addEventListener("click",function(){setQuality(this.dataset.format)}),qualitySelection.appendChild(element),qualitySelection.dataset.number=b+1;setQuality(a[0].format)}function createSubTilte(a,b){element=document.createElement("span"),element.id="sub_title"+(a+1),element.className="subtitle",video.currentTime>b.start&&video.currentTime<b.end||(element.className+=" hidden"),element.innerHTML="<p>"+b.text+"</p>",element.dataset.start=b.start,element.dataset.end=b.end,element.style.left=b.left+"%",element.style.top=b.top+"%",element.style.width=b.width+"%",element.style.minHeight=b.height+"%",subtitlesList.appendChild(element)}function updateSubTitles(){if(subtitles){currentTime=video.currentTime,children=subtitlesList.children;for(var a=children.length,b=a-1;b>-1;b--)(currentTime<children[b].dataset.start||currentTime>children[b].dataset.end)&&children[b].className.search("hidden")<0&&(children[b].className+=" hidden");for(var b=0,a=subtitles.length;a>b;b++)currentTime>subtitles[b].start&&currentTime<subtitles[b].end&&(document.getElementById("sub_title"+(b+1))?document.getElementById("sub_title"+(b+1)).className.search("hidden")&&(document.getElementById("sub_title"+(b+1)).className=document.getElementById("sub_title"+(b+1)).className.replace("hidden","")):createSubTilte(b,subtitles[b]))}}function setSubTitles(a){if(a.length){document.getElementById("annotationsButton").style.display="block",subtitles=a;for(var b=0,c=subtitles.length;c>b;b++)createSubTilte(b,subtitles[b])}}function closeAnnotation(a){a.style.display="none"}function createAnnotation(a,b){element=document.createElement("span"),element.id="ann"+(a+1),element.className="annotation "+(b.color?b.color:""),video.currentTime>b.start&&video.currentTime<b.end||(element.className+=" hidden"),element.dataset.start=b.start,element.dataset.end=b.end,element.innerHTML=b.link?"undefined"==typeof annoTimeLine?"<a href="+b.link+' target="_blank">'+b.text+"</a>":"<a href="+b.link+' contentEditable="true" target="_blank" onkeydown="keyPressAnno(event, this.parentNode);">'+b.text+"</a>":"undefined"==typeof annoTimeLine?"<p>"+b.text+"</p>":'<p contentEditable="true" onkeydown="keyPressAnno(event, this.parentNode);">'+b.text+"</p>","undefined"==typeof annoTimeLine&&(element.innerHTML+='<span class="close" onclick="closeAnnotation(this.parentNode);"></span>'),element.style.left=b.left+"%",element.style.top=b.top+"%",element.style.width=b.width+"%",element.style.minHeight=b.height+"%",element.addEventListener("click",function(){setQuality(this.dataset.format)}),"undefined"!=typeof annoTimeLine&&annotDraggable(element),annotationsElement.appendChild(element)}function updateAnnotations(){if(annotations){currentTime=video.currentTime,children=annotationsElement.children;for(var a=children.length,b=a-1;b>-1;b--)(currentTime<children[b].dataset.start||currentTime>children[b].dataset.end)&&children[b].className.search("hidden")<0&&(children[b].className+=" hidden");for(var b=0,a=annotations.length;a>b;b++)currentTime>annotations[b].start&&currentTime<annotations[b].end&&(document.getElementById("ann"+(b+1))?document.getElementById("ann"+(b+1)).className.search("hidden")&&(document.getElementById("ann"+(b+1)).className=document.getElementById("ann"+(b+1)).className.replace("hidden","")):createAnnotation(b,annotations[b]))}}function setAnnotations(a){if(a.length){document.getElementById("annotationsButton").style.display="block",annotations=a;for(var b=0,c=annotations.length;c>b;b++)createAnnotation(b,annotations[b]),"undefined"!=typeof annoTimeLine&&createAnnotationInList(b,annotations[b])}}function onMediaDiscovered(a,b){currentMedia=b,currentMedia.addUpdateListener(onMediaStatusUpdate),mediaCurrentTime=currentMedia.currentTime}function onMediaStatusUpdate(){"PLAYING"===currentMedia.playerState?(mediaCurrentTime=currentMedia.currentTime,chromecastTimer=setInterval(function(){mediaCurrentTime++,console.log(mediaCurrentTime)},1e3)):clearInterval(chromecastTimer)}function sessionListener(a){console.log("New session ID: "+a.sessionId),currentSession=a,0!=currentSession.media.length&&(console.log("Found "+currentSession.media.length+" existing media sessions."),onMediaDiscovered("sessionListener",currentSession.media[0])),currentSession.addMediaListener(onMediaDiscovered.bind(this,"addMediaListener")),currentSession.addUpdateListener(sessionUpdateListener.bind(this))}function sessionUpdateListener(a){a||(currentSession=null,chromecastTimer&&clearInterval(chromecastTimer))}function receiverListener(a){"available"===a&&(chromecastplayicon.style.display="block",setTimeout(function(){chromecastplayicon.className+=" show"},10))}function subscribeAction(a){var b=document.getElementById("subscribe-button");hasClass(b,"subscribed")?ajax.get(a+"/unsubscribe/",{}):ajax.get(a+"/subscribe/",{})}function cancelUpload(){return uploadHttpRequest?(uploadHttpRequest.abort(),void uploadInput.removeAttribute("disabled")):!1}function tempsRestant(a){var b=Math.round(a/1e3),c=Math.round(b/60),d=Math.round(c/60);return 1>b?"une seconde":60>b?b+" secondes":1===c?c+" une minute":14>c?c+" minutes":16>c?"un quart d'heures":29>c?c+" minutes":31>c?"une demi heure":55>c?c+" minutes":65>c?"une heure":120>c?"une heure":1440>c?d+" heures":"trÃ¨s longtemps"}function submitVideoInfo(){var a=document.getElementById("video-title").value,b=document.getElementById("video-description").value,c=document.getElementById("video-tags").value,d=(document.getElementById("video-tumbnail").files[0],document.getElementById("video-visibility").value);ajax.post("upload/",{videoTitle:a,videoDescription:b,videoTags:c,videoVisibility:d});var e=new XMLHttpRequest;e.open("POST","upload/addthumb");var f=new FormData;f.append("videoThumbnail",document.getElementById("video-tumbnail").files[0]),e.send(f)}function hasClass(a,b){return(" "+a.className+" ").indexOf(" "+b+" ")>-1}function votePlus(a,b){for(var c=b,d=document.createElement("div"),e=b.parentNode.childNodes,f=0;f<e.length;f++)e[f].className&&e[f].className.search("moins")>-1&&(d=e[f]);c.className.search("active")>-1?(c.className=c.className.replace("active",""),c.innerHTML=parseInt(c.innerHTML)-1,ajax.get("unlike/"+a,{})):(c.className=c.className+" active",c.innerHTML=parseInt(c.innerHTML)+1,ajax.get("like/"+a,{}),d.className.search("active")>-1&&(d.className=d.className.replace("active",""),d.innerHTML=parseInt(d.innerHTML)-1,ajax.get("undislike/"+a,{})))}function voteMoins(a,b){for(var c=b,d=document.createElement("div"),e=b.parentNode.childNodes,f=0;f<e.length;f++)e[f].className&&e[f].className.search("plus")>-1&&(d=e[f]);c.className.search("active")>-1?(c.className=c.className.replace("active",""),c.innerHTML=parseInt(c.innerHTML)-1,ajax.get("undislike/"+a,{})):(c.className=c.className+" active",c.innerHTML=parseInt(c.innerHTML)+1,ajax.get("dislike/"+a,{}),d.className.search("active")>-1&&(d.className=d.className.replace("active",""),d.innerHTML=parseInt(d.innerHTML)-1,ajax.get("unlike/"+a,{})))}var marmottajax=function(a){return marmottajax.get(a)};marmottajax.n=function(a){return a?"string"==typeof a?{url:a}:a:!1},marmottajax.json=function(a){return(a=marmottajax.n(a))?(a.json=!0,new marmottajax.r(a)):void 0},marmottajax.get=function(a){return new marmottajax.r(a)},marmottajax.post=function(a){return(a=marmottajax.n(a))?(a.method="POST",new marmottajax.r(a)):void 0},marmottajax.r=function(a){if(!a)return!1;if("string"==typeof a&&(a={url:a}),"POST"===a.method){var b="?";for(var c in a.options)b+=a.options.hasOwnProperty(c)?"&"+c+"="+a.options[c]:""}else{a.method="GET",a.url+=a.url.indexOf("?")<0?"?":"";for(var c in a.options)a.url+=a.options.hasOwnProperty(c)?"&"+c+"="+a.options[c]:""}this.x=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.x.o=a,this.x.c={t:[],e:[]},this.then=function(a){return this.x.c.t.push(a),this},this.error=function(a){return this.x.c.e.push(a),this},this.x.l=function(a,b){for(var c=0;c<this.c[a].length;c++)"function"==typeof this.c[a][c]&&this.c[a][c](b)},this.x.y=function(a){this.l("t",a)},this.x.z=function(a){this.l("e",a)},this.x.onreadystatechange=function(){if(4===this.readyState&&200==this.status){var a=this.responseText;if(this.o.json)try{a=JSON.parse(a)}catch(b){return this.z("invalid json"),!1}this.y(a)}else 4===this.readyState&&404==this.status?this.z("404"):4===this.readyState&&this.z("unknow")},this.x.open(a.method,a.url,!0),this.x.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.x.send("undefined"!=typeof b?b:null)},document.addEventListener("DOMContentLoaded",function(){for(var a=0;a<_scripts_.length;a++){var b=!1,c=_scripts_[a];if("*"!==c.pages&&"all"!==c.pages&&c.pages)for(var d=0;d<c.pages.length;d++)c.pages[d]===_currentpage_&&(b=!0);else b=!0;b&&c.call()}},!1);var _scripts_=[],Script=function(a){this.pages=a.pages,this.to_call=a.call,_scripts_.push(this)};Script.prototype.call=function(){this.to_call()};var bg_loader=new Script({call:function(){var a=document.getElementsByClassName("bgLoader");a.length&&console.error(a.length+" éléments possedent la classe bgLoader qui n'est plus utilisée.");for(var b=document.getElementsByClassName("bg-loader"),c=0;c<b.length;c++)a.push(b[c]);if(a&&a.length)for(var c=0,d=a.length;d>c;c++)new background_loader(a[c])}}),meteo=new Script({pages:["default","watch"],call:function(){console.log("Il pleut!","{example script}")}}),filePreview=function(a){this.element=a,this.input=document.getElementById(this.element.getAttribute("data-input")),this.input.addEventListener("change",function(){if(this.files&&this.files[0]){var a=new FileReader;a.onload=function(a){this.cible.className=this.cible.className.replace(" none",""),this.cible.src=a.target.result},a.cible=document.getElementById(this.getAttribute("data-preview")),a.readAsDataURL(this.files[0])}},!1)},elements=document.getElementsByClassName("filePreview");if(elements&&elements.length)for(var i=0,length=elements.length;length>i;i++)filePreview(elements[i]);var body=document.getElementById("page"),button_nav_mobile=document.getElementById("mobile-nav-icon")||document.createElement("div"),nav=document.getElementById("header-menu-nav")||document.createElement("div");button_nav_mobile.addEventListener("click",function(){button_nav_mobile.className.search("open")>0?(button_nav_mobile.className=button_nav_mobile.className.replace("open",""),nav.className=nav.className.replace("open","")):(button_nav_mobile.className+=" open",nav.className+=" open")});var button_user_info=document.getElementById("top-nav-user-information-button")||document.createElement("div"),user_info_menu=document.getElementById("top-nav-user-information-menu")||document.createElement("div");button_user_info.addEventListener("click",function(){user_info_menu.style.display="inline"!=user_info_menu.style.display?"inline":"none"}),body.addEventListener("click",function(a){user_info_menu.style.display="top-nav-user-information-button"!=a.target.id&&"top-nav-user-information-button"!=a.target.parentNode.id?"none":user_info_menu.style.display});var hover_subscribe=document.getElementById("hover_subscribe")||document.createElement("div");hover_subscribe.addEventListener("click",function(){"subscribed"==hover_subscribe.className?(hover_subscribe.className="",hover_subscribe.childNodes[0].innerHTML="S'abonner",ajax.post({action:"unsubscribe",dr_id:hover_subscribe.dataset.vid})):(hover_subscribe.className="subscribed",hover_subscribe.childNodes[0].innerHTML="Abonné",ajax.post({action:"subscribe",dr_id:hover_subscribe.dataset.vid}))});var subscribe_button=document.getElementById("subscribe-button")||document.createElement("div");subscribe_button.addEventListener("click",function(){"subscribed"==subscribe_button.className?(subscribe_button.className="",subscribe_button.innerHTML=subscribe_button.dataset.text.split("|")[0],ajax.post({action:"unsubscribe"})):(subscribe_button.className="subscribed",subscribe_button.innerHTML=subscribe_button.dataset.text.split("|")[1],ajax.post({action:"subscribe"}))}),console.log(_currentpage_),_currentpage_||console.error("La variable _currentpage_ n'est pas définie.");var marmottajax=function(a){return marmottajax.get(a)};marmottajax.n=function(a){return a?"string"==typeof a?{url:a}:a:!1},marmottajax.json=function(a){return(a=marmottajax.n(a))?(a.json=!0,new marmottajax.r(a)):void 0},marmottajax.get=function(a){return new marmottajax.r(a)},marmottajax.post=function(a){return(a=marmottajax.n(a))?(a.method="POST",new marmottajax.r(a)):void 0},marmottajax.r=function(a){if(!a)return!1;if("string"==typeof a&&(a={url:a}),"POST"===a.method){var b="?";for(var c in a.options)b+=a.options.hasOwnProperty(c)?"&"+c+"="+a.options[c]:""}else{a.method="GET",a.url+=a.url.indexOf("?")<0?"?":"";for(var c in a.options)a.url+=a.options.hasOwnProperty(c)?"&"+c+"="+a.options[c]:""}this.x=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.x.o=a,this.x.c={t:[],e:[]},this.then=function(a){return this.x.c.t.push(a),this},this.error=function(a){return this.x.c.e.push(a),this},this.x.l=function(a,b){for(var c=0;c<this.c[a].length;c++)"function"==typeof this.c[a][c]&&this.c[a][c](b)},this.x.y=function(a){this.l("t",a)},this.x.z=function(a){this.l("e",a)},this.x.onreadystatechange=function(){if(4===this.readyState&&200==this.status){var a=this.responseText;if(this.o.json)try{a=JSON.parse(a)}catch(b){return this.z("invalid json"),!1}this.y(a)}else 4===this.readyState&&404==this.status?this.z("404"):4===this.readyState&&this.z("unknow")},this.x.open(a.method,a.url,!0),this.x.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.x.send("undefined"!=typeof b?b:null)},player=document.getElementById("player"),videoInfos=document.getElementById("videoInfos"),player.style.height="undefined"!=typeof embeded?document.documentElement.clientHeight+"px":player.offsetWidth/(16/9)+"px",document.body.clientWidth<640&&(player.style.width=document.body.clientWidth+"px",player.style.height="undefined"!=typeof embeded?document.documentElement.clientHeight+"px":player.offsetWidth/(16/9)+"px"),videoInfos&&(videoInfos.style.height=player.offsetWidth/(16/9)+"px"),window.addEventListener("resize",resized,!1),video=player.getElementsByTagName("video")[0],srcMp4=document.getElementById("srcMp4"),srcWebm=document.getElementById("srcWebm"),controls=document.getElementById("controls"),playPauseElement=document.getElementById("play-pause"),playPauseElement.addEventListener("click",playPause),annotationsElement=document.getElementById("annotationsElement"),annotationsElement.addEventListener("click",function(a){a.target===annotationsElement&&("down"==controls.className?upPlayer():playPause())}),time=document.getElementById("time"),video.addEventListener("canplay",function(){video.duration&&(time.innerHTML=time2str(video.currentTime)+" / "+time2str(video.duration)),playPauseElement.className=video.paused?"play":"pause"}),waitForPlay=document.getElementById("waitForPlay"),waitForPlay.addEventListener("click",function(){video.play()},!1),bigPlay=document.getElementById("bigPlay"),bigPlay.addEventListener("webkitAnimationEnd",function(){this.style.webkitAnimationName=""},!1),bigPlay.addEventListener("msAnimationEnd",function(){this.style.msAnimationName=""},!1),bigPlay.addEventListener("oAnimationEnd",function(){this.style.oAnimationName=""},!1),bigPlay.addEventListener("animationend",function(){this.style.mozAnimationName="",this.style.animationName=""},!1),video.addEventListener("play",function(){waitForPlay.style.display="none",playPauseElement.className="pause",video.currentTime!=video.duration&&0!=video.currentTime&&(bigPlay.style.webkitAnimationName="bigIconPlay",bigPlay.style.mozAnimationName="bigIconPlay",bigPlay.style.msAnimationName="bigIconPlay",bigPlay.style.oAnimationName="bigIconPlay",bigPlay.style.animationName="bigIconPlay")},!1),bigPause=document.getElementById("bigPause"),bigPause.addEventListener("webkitAnimationEnd",function(){this.style.webkitAnimationName=""},!1),bigPause.addEventListener("msAnimationEnd",function(){this.style.msAnimationName=""},!1),bigPause.addEventListener("oAnimationEnd",function(){this.style.oAnimationName=""},!1),bigPause.addEventListener("animationend",function(){this.style.mozAnimationName="",this.style.animationName=""},!1),video.addEventListener("pause",function(){playPauseElement.className="play",video.currentTime!=video.duration&&(bigPause.style.webkitAnimationName="bigIconPause",bigPause.style.mozAnimationName="bigIconPause",bigPause.style.msAnimationName="bigIconPause",bigPause.style.oAnimationName="bigIconPause",bigPause.style.animationName="bigIconPause")}),progress=document.getElementById("progress"),progress.buffered=document.getElementById("buffered"),progress.viewed=document.getElementById("viewed"),progress.current=document.getElementById("current"),video.addEventListener("timeupdate",function(){percent=video.currentTime/video.duration*100+"%",progress.viewed.style.width=percent,progress.current.style.left=percent,time.innerHTML=video.duration?time2str(video.currentTime)+" / "+time2str(video.duration):""}),video.addEventListener("loadedmetadata",function(){video.buffered&&setInterval(bufferUpdate,500)}),mouseDown=!1,progress.addEventListener("mousedown",function(a){mouseDown=!0,video.duration&&(video.currentTime=(a.clientX-getOffset(progress))/progress.offsetWidth*video.duration)}),document.addEventListener("mouseup",function(){progress.className="",mouseDown=!1}),document.addEventListener("mousemove",function(a){mouseDown&&(progress.className="clicking",percent=(a.clientX-getOffset(progress))/progress.offsetWidth*100+"%",progress.viewed.style.width=percent,progress.current.style.left=percent,video.currentTime=(a.clientX-getOffset(progress))/progress.offsetWidth*video.duration)});var lastTime,time2down=4e3,timeout=setTimeout(downPlayer,time2down/2);player.addEventListener("mousemove",upPlayer),widescreen=document.getElementById("widescreen"),widescreen.addEventListener("click",function(){(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)&&toogleFullScreen(),player.style.height="",videoInfos&&(videoInfos.style.height=""),player.className.search("wide")<0?(player.className="animated wide",widescreen.className="smallscreen"):(player.className="animated",widescreen.className="widescreen");setTimeout(function(){player.className=player.className.search("wide")>0?"wide":"",player.style.height="undefined"!=typeof embeded?document.documentElement.clientHeight+"px":player.offsetWidth/(16/9)+"px"},400)}),fullscreen=document.getElementById("fullscreen"),fullscreen.addEventListener("click",toogleFullScreen),window.addEventListener("orientationchange",function(){0==window.orientation&&(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)&&toogleFullScreen()},!1),annotationsElement.addEventListener("dblclick",toogleFullScreen),document.addEventListener("webkitfullscreenchange",function(){setImageFullscreen(document.webkitFullscreenElement?"lowscreen":"fullscreen")},!1),document.addEventListener("mozfullscreenchange",function(){setImageFullscreen(document.mozFullScreenElement?"lowscreen":"fullscreen")},!1),document.addEventListener("msfullscreenchange",function(){setImageFullscreen(document.msFullscreenElement?"lowscreen":"fullscreen")},!1),document.addEventListener("fullscreenchange",function(){setImageFullscreen(document.fullscreenElement?"lowscreen":"fullscreen")},!1),volume=document.getElementById("volume"),volume.barre=document.getElementById("barre"),volume.icon=document.getElementById("icon"),video.addEventListener("volumechange",function(){percent=100*video.volume+"%",volume.barre.style.width=percent,volume.icon.style.left=percent,video.volume<=.05?volume.icon.dataset.volume=0:video.volume<=.4?volume.icon.dataset.volume=1:video.volume<=.6?volume.icon.dataset.volume=2:video.volume>=.6&&(volume.icon.dataset.volume=3)},!1);var volumeBeforeUp=1,mouseDownVolume=!1;volume.addEventListener("mousedown",function(a){volumeBeforeUp=video.volume,mouseDownVolume=!0,newVolume=(a.clientX-getOffset(volume))/volume.offsetWidth,newVolume=0>newVolume?0:newVolume>1?1:newVolume,video.volume=newVolume}),document.addEventListener("mousemove",function(a){mouseDownVolume&&(percent=100*video.volume+"%",volume.barre.style.width=percent,volume.icon.style.left=percent,newVolume=(a.clientX-getOffset(volume))/volume.offsetWidth,newVolume=0>newVolume?0:newVolume>1?1:newVolume,video.volume=newVolume)},!1),document.addEventListener("mouseup",function(a){mouseDownVolume=!1,video.volume!=volumeBeforeUp&&a.target===volume.icon&&volumeChange()}),player.addEventListener("mousewheel",mouseWheelVolume,!1),player.addEventListener("DOMMouseScroll",mouseWheelVolume,!1),repeat=document.getElementById("repeat"),video.addEventListener("ended",function(){repeat.className="show"},!1),repeat.addEventListener("click",function(){repeat.className="",video.currentTime=0,playPause()},!1),video.addEventListener("play",function(){repeat.className=""},!1);var lastTime=0,currentQuality;qualitySelection=document.getElementById("qualitySelection"),qualitySelection.addEventListener("click",function(){qualitySelection.className=""}),qualityButton=document.getElementById("qualityButton"),qualityButton.addEventListener("click",function(){2==qualitys.length?setQuality(qualitys[0].format==currentQuality?qualitys[1].format:qualitys[0].format):qualitys.length>1&&(qualitySelection.className="show")});var qualitys,subtitles,subtitlesList=document.getElementById("subtitlesList");document.getElementById("annotationsButton").addEventListener("click",function(){subtitlesList.className=subtitlesList.className?"":"hide"}),video.addEventListener("timeupdate",updateSubTitles);var annotations,annoList=document.getElementById("annoList");document.getElementById("annotationsButton").addEventListener("click",function(){annotationsElement.className?(document.getElementById("annotationsButton").className="",annotationsElement.className=""):(document.getElementById("annotationsButton").className="not",annotationsElement.className="hide")}),video.addEventListener("timeupdate",updateAnnotations),document.addEventListener("keydown",function(a){a.target==document.body&&(32==a.keyCode&&(playPause(),upPlayer()),70==a.keyCode&&toogleFullScreen(),36==a.keyCode&&(video.currentTime=0,video.play(),progress.viewed.style.width="0%",progress.current.style.left="0%"),35==a.keyCode&&(video.currentTime=video.duration,progress.viewed.style.width="100%",progress.current.style.left="100%"),38==a.keyCode&&(lastVolume=video.volume,video.volume=Math.min(video.volume+.1,1),lastVolume!=video.volume&&volumeChange()),40==a.keyCode&&(lastVolume=video.volume,video.volume=Math.max(video.volume-.1,0),lastVolume!=video.volume&&volumeChange()),37==a.keyCode&&(video.currentTime-=3),39==a.keyCode&&(video.currentTime+=3))});var chromecastplayicon=document.getElementById("chromecastplayicon"),currentMedia=null,currentSession=null;mediaCurrentTime=0,chromecastTimer=null,chromecastplayicon.addEventListener("click",function(){chrome.cast.requestSession(function(a){currentSession=a;var b=new chrome.cast.media.MediaInfo("http://dreamvids.fr/uploads/Dimou/AxRw02.webm_640x360p.mp4");b.contentType="video/mp4";var c=new chrome.cast.media.LoadRequest(b);c.autoplay=!0,c.currentTime=0,currentSession.loadMedia(c,onMediaDiscovered.bind(this,"loadMedia"),function(){console.error("Erreur lors du lancement de la vidéo.")})},function(){console.error("Erreur lors du lancement de l'application.")})}),window.addEventListener("load",function(){chrome.cast&&chrome.cast.isAvailable||setTimeout(function(){var a=chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,b=new chrome.cast.SessionRequest(a),c=new chrome.cast.ApiConfig(b,sessionListener,receiverListener);chrome.cast.initialize(c,function(){},function(){console.error("Erreur lors de l'initialisation de ChromeCast.")})},1e3)},!1);var uploader=document.getElementById("uploader"),uploadInput=document.getElementById("upload-input"),fileName=document.getElementById("file-name"),progressBar=document.getElementById("progress-bar"),timeUpload={started:0,current:0};uploadInput.addEventListener("change",function(){var a=uploadInput.value.split(".")[uploadInput.value.split(".").length-1].toLowerCase(),b=["webm","mp4","mov","avi","wmv","ogg","ogv"];if(-1!=b.indexOf(a)){ajax.get("upload/preprocess"),uploader.className=uploader.className.replace(" hover",""),uploader.className="uploading";var c=uploadInput.files[0].name.replace(/\.[0-9a-z]+$/i,"");fileName.innerHTML=c,""==document.getElementById("video-title").value&&(document.getElementById("video-title").value=c),uploadInput.setAttribute("disabled",""),document.getElementById("up-submit").removeAttribute("disabled"),uploadHttpRequest=new XMLHttpRequest,uploadHttpRequest.open("POST","upload/process/"),uploadHttpRequest.upload.onprogress=function(a){timeUpload.current=(new Date).getTime();var b=(timeUpload.current-timeUpload.started)*a.total/a.loaded;time=b-(timeUpload.current-timeUpload.started),restant=tempsRestant(time),progressBar.dataset.restant=restant,percent=Math.round(a.loaded/a.total*100),progressBar.style.width=progressBar.dataset.percent=percent+"%",document.title=100!=percent?percent+"% | "+restant+" restant":"Upload terminé"},uploadHttpRequest.onload=function(){uploader.className="uploaded",progressBar.style.width="100%"};var d=new FormData;d.append("videoInput",uploadInput.files[0]),uploadHttpRequest.send(d),timeUpload.started=(new Date).getTime()}else alert("Type de fichier incorrect")},!1);